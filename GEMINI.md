# yak-biseo_mvp 개발 규칙

> ⚠️ **이 파일의 모든 규칙은 절대적이다. 모든 작업에서 반드시 따른다.**

---

## 🚨 CRITICAL RULES (최우선)

### NEVER DO (절대 금지)

1. **API Key, 토큰, 비밀번호를 코드에 하드코딩하지 마라**
2. **사용자 승인 없이 새 패키지를 추가하지 마라**
3. **사용자 승인 없이 대규모 구조 변경을 하지 마라**
4. **여러 기능을 하나의 변경에 섞지 마라** (1변경 = 1의도)
5. **`.env` 파일 내용을 출력하거나 공유하지 마라**

### ALWAYS DO (필수 수행)

1. **변경 전 반드시 계획을 먼저 제시하라:**
   - 요구사항 이해 요약 (1-3줄)
   - 작업 계획 (3-7개 bullet)

2. **변경은 작은 단위로 쪼개라:**
   - 한 번에 하나의 파일/기능만 변경
   - 되돌리기 쉬운 크기 유지

3. **기존 코드 스타일을 따르라:**
   - 새 패턴 도입 전 기존 패턴 확인
   - 네이밍/구조는 기존 방식 유지

4. **응답 시 아래 형식을 사용하라:**
   ```
   1) 요약 (한 줄)
   2) 변경 파일 목록
   3) 핵심 설계 결정 (3-5줄)
   4) 코드 (필요한 부분만)
   5) 검증 방법
   ```

### STOP AND ASK (멈추고 질문)

다음 상황에서는 구현 전에 반드시 사용자에게 확인하라:
- 새 패키지 도입이 필요할 때
- 기존 아키텍처 변경이 필요할 때
- 요구사항이 불명확할 때
- 2개 이상의 접근 방식이 가능할 때

---

## 📱 Flutter 개발 규칙

### 코드 스타일

**DO ✅**
- `snake_case.dart` 파일명
- `PascalCase` 클래스/enum
- `camelCase` 변수/함수
- `final`/`const` 적극 사용
- 명시적 타입 선언
- Effective Dart + null-safety 준수

**DON'T ❌**
- `dynamic` 타입 남발 금지
- `!` (null assertion) 무분별 사용 금지
- `build()` 안에서 무거운 계산/IO 금지

### 위젯 설계

**DO ✅**
- 큰 화면을 **작은 위젯으로 분리**
- `ListView.builder` 등 lazy 빌드 사용
- 로딩/에러/빈 상태를 명확히 분리
- 재사용 UI는 공용 컴포넌트로 추출

**DON'T ❌**
- 하나의 거대한 위젯으로 화면 구성 금지
- 상태별 UI 처리 누락 금지

### 상태관리

**DO ✅**
- 기존 프로젝트의 상태관리 방식 확인 후 따르기
- 비즈니스 로직은 UI에서 분리
- 단순 UI 상태는 `StatefulWidget`/`ValueNotifier`로 충분

**DON'T ❌**
- 사용자 승인 없이 새 상태관리 패키지 추가 금지
- UI에 비즈니스 로직 직접 작성 금지

### 네트워크/데이터

**DO ✅**
- UI → Repository → DataSource 계층 분리
- DTO ↔ Domain 변환은 한 곳에서 관리
- 실패 케이스 명확히 모델링
- 로딩/취소/에러 처리 포함

**DON'T ❌**
- UI에서 HTTP/DB 직접 호출 금지
- 에러 처리 누락 금지

### MVP/더미 데이터

**DO ✅**
- 더미 데이터는 `lib/data/mock/` 또는 `lib/data/sources/local/`에 분리
- `Future.delayed`로 네트워크 지연 시뮬레이션
- Repository 인터페이스는 실제 API와 유사하게 설계

**DON'T ❌**
- UI 코드 내부에 더미 데이터 하드코딩 금지

### AI/Gemini 연동

**DO ✅**
- AI 생성 JSON 파싱 시 `try-catch` 필수
- 숫자 변환 시 `int.tryParse` 등 안전한 변환
- Default Value 처리 포함

---

## 🎨 UI/UX (약비서 전용)

- **타겟: 4050 세대** → 텍스트 크기 충분히, 명도 대비 확실히
- **UI 텍스트: 한국어(Korean)** 기본
- **컬러:** 긍정=Green, 경고=Amber/Orange
- `Theme.of(context)` 활용 권장

---

## 🔄 개발 철학 (Kent Beck / XP)

### 핵심 원칙

> **작게(Small) → 피드백(Feedback) → 단순하게(Simple) → 정리(Refactor)**

### 작업 루프

```
1. 가장 작은 다음 행동 선택
2. 즉시 확인 (테스트/분석/실행)
3. 동작 유지하며 구조 개선
4. 반복
```

### 변경 단위

- 1변경 = 1의도 (기능추가/리팩터링/포맷 섞지 않음)
- 큰 작업은 작은 스텝들로 분해
- 각 스텝은 되돌리기 쉽게

### 단순함 기준

**DO ✅**
- 현재 요구사항을 만족하는 **가장 단순한 설계**
- 중복 제거 시 명확한 이름/구조로 드러내기

**DON'T ❌**
- "나중에 필요할 것 같아서" 만드는 추상화 금지
- 성급한 추상화로 복잡성 숨기기 금지

---

## 📝 Git 규칙

### 커밋 단위

- **1 변경사항 = 1 커밋**
- 여러 기능을 한 커밋에 넣지 마라

### Pre-commit 체크리스트

```bash
flutter analyze   # Error 0개 확인
dart format .     # 포맷 정리
```

**확인 항목:**
- [ ] `flutter analyze` Error 없음
- [ ] `.env` 파일이나 API Key 미포함
- [ ] 디버그용 `print()` 제거됨

### 커밋 메시지 형식

```
<type>: <subject>
```

| Type | 용도 | 예시 |
|------|------|------|
| `feat` | 새 기능 | `feat: 검색 화면 UI 구현` |
| `fix` | 버그 수정 | `fix: 가격 계산 오류 수정` |
| `refactor` | 구조 개선 | `refactor: Repository 패턴 적용` |
| `docs` | 문서 수정 | `docs: README 업데이트` |
| `chore` | 설정/빌드 | `chore: pubspec 정리` |

**Subject:** 50자 이내, 마침표 없음

---

## ✅ Definition of Done

PR/Merge 전 체크리스트:

- [ ] 코드가 동작한다 (최소 1개 검증 경로)
- [ ] `flutter analyze` Error 0개
- [ ] 실패 케이스 처리됨 (에러/빈 상태)
- [ ] 의도가 드러나는 이름/구조
- [ ] PR Description 작성 (What/Why/How)