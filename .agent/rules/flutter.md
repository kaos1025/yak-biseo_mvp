---
trigger: always_on
---

# Flutter 워크스페이스 규칙 (yak-biseo_mvp)

- 이 워크스페이스의 모든 변경은 `.agent/rules/kent_beck.md`의 “작게/피드백/단순함/리팩터링” 원칙을 따른다.

## 0) 목적
- 이 저장소는 Flutter 앱 프로젝트다.
- 목표: 유지보수성, 성능, 안정성(에러/상태 처리), 테스트 용이성을 우선한다.
- 큰 구조 변경/패키지 도입/대규모 리팩터링은 **요청 또는 명시적 합의 없이는 하지 않는다.**

---

## 1) 작업 방식(필수)
- 변경은 **작고 리뷰 가능한 단위**로 쪼갠다.
- 구현 전에는 반드시:
  - 내가 이해한 요구사항/가정(필요 시) 1~3줄 요약
  - 작업 계획 3~7개 불릿 제시
- 기존 코드 스타일/패턴을 최우선으로 따른다(불필요한 네이밍/구조 변경 금지).

---

## 2) 보안/비밀정보(필수)
- API Key/토큰/비밀번호/개인정보 등 민감정보를 **코드/로그/문서에 절대 하드코딩하지 않는다.**
- `.env` 같은 파일 값은 절대 출력/공유하지 않고, 예시는 키 이름만 사용한다.
  - 예: `API_BASE_URL=...`, `FIREBASE_PROJECT_ID=...`

---

## 3) 코드 스타일 (Dart/Flutter)
- Effective Dart + sound null-safety 준수.
- `dynamic` 남발 금지. 명확한 타입을 우선한다.
- `!`(null assertion)는 정말 보장되는 경우만 사용하고, 가능하면 방어적으로 처리한다.
- 파일명: `snake_case.dart`
- 클래스/enum: `PascalCase`
- 변수/함수/필드: `camelCase`
- `final`/`const`를 적극 사용한다(특히 const 위젯).
- `build()` 안에서 무거운 계산/IO/변환 로직을 하지 않는다(별도 함수/클래스로 분리).

---

## 4) 위젯 설계 원칙
- 화면은 큰 위젯 하나로 끝내지 말고 **작은 위젯/컴포넌트로 분리**한다.
- 재사용 가능한 UI는 공용 컴포넌트로 분리(프로젝트의 기존 위치/규칙을 따른다).
- 리스트/스크롤은 `ListView.builder` 등 lazy 빌드를 우선한다.
- 로딩/에러/빈 상태(Empty)를 명확히 분리해 UI에 표현한다.

---

## 5) 폴더/아키텍처
- 프로젝트가 이미 사용하는 구조를 우선한다(새 구조 강제 금지).
- 새 기능을 추가해야 한다면, 가능한 한 feature-first 기반을 권장:
  - `lib/features/<feature>/presentation` (화면/위젯/상태)
  - `lib/features/<feature>/domain` (엔티티/유스케이스/추상화)
  - `lib/features/<feature>/data` (API/저장소 구현/DTO/매퍼)
- 공통 코드는 `lib/core` 또는 기존의 공용 폴더(`shared` 등)에 둔다.

---

## 6) 상태관리
- **새 상태관리 패키지 추가 금지**(요청/합의 없이는).
- 기존에 사용 중인 방식(setState/Provider/Riverpod/BLoC 등)을 확인한 후 그대로 따른다.
- 기본 원칙:
  - 단순 UI 상태는 `StatefulWidget`, `ValueNotifier`, `ChangeNotifier` 등으로 과하게 복잡하게 만들지 않는다.
  - 비즈니스 로직은 UI에서 분리해 테스트 가능하게 만든다.

---

## 7) 라우팅/네비게이션
- 기존 라우팅 방식(Navigator 1.0/2.0, go_router 등)이 있으면 유지한다.
- 라우트 문자열/경로를 화면에서 하드코딩하지 말고, 중앙화된 라우팅 정의를 선호한다.
- 새로운 라우팅 도입이 필요하면 “제안”만 하고, 적용은 사용자 승인 후 진행한다.

---

## 8) 네트워크/데이터 접근
- UI에서 HTTP/DB를 직접 호출하지 않도록(가능하면) 계층을 분리한다.
- DTO ↔ Domain 변환(매핑)은 한 곳에 모아 일관되게 관리한다.
- 중복 요청/연타/화면 전환 시 안전하도록 로딩/취소/에러 처리를 고려한다.
- 실패 케이스(네트워크 오류/파싱 오류/권한 오류)를 명확히 모델링한다.

---

## 9) Firebase/Web 관련(해당 시)
- Web에서 동작하지 않는 플러그인 도입 시 플랫폼 호환성 체크 후 제안한다.
- `firebase.json` 및 Web 설정 변경은 최소화하고, 변경 이유/영향을 명확히 설명한다.

---

## 10) 품질 도구(Lint/Format)
- 프로젝트의 `analysis_options.yaml` 규칙을 따른다.
- 코드 제출 전 권장:
  - 포맷: `dart format .`
  - 정적 분석: `flutter analyze`
  - 자동 수정 검토: `dart fix --apply`(필요 시)

---

## 11) 테스트
- 비즈니스 로직(도메인/유스케이스)은 가능하면 단위 테스트를 추가한다.
- UI는 핵심 플로우 위주로 위젯 테스트를 추가한다(과도한 스냅샷 지양).
- mock 남발을 피하고 fake/stub를 우선한다.

---

## 12) 응답/변경 제안 포맷(필수)
항상 아래 순서로 제시한다.
1) 요약(한 줄)
2) 변경 파일 목록
3) 핵심 설계/의사결정(3~5줄)
4) 패치/코드(필요한 부분만)
5) 검증 방법(명령 제시만, 실행은 사용자가)

---

## 13) MVP 및 더미 데이터(Dummy Data) 규칙 (프로젝트 특화)
- **가짜 데이터 분리:** 더미 데이터는 UI 코드 내부에 하드코딩하지 말고, 반드시 `lib/data/sources/local` 또는 `lib/data/mock` 등 별도 파일로 분리한다.
- **비동기 시뮬레이션:** 검색이나 데이터 로딩 기능을 구현할 때는 `Future.delayed`를 사용하여 **실제 네트워크 지연(Loading State)**을 반드시 흉내 낸다. (로딩 UI 테스트 목적)
- **교체 용이성:** 나중에 실제 API로 교체할 때 코드 변경을 최소화하도록, Repository 인터페이스나 함수 시그니처를 실제 API와 유사하게 설계한다.

---

## 14) UI/UX 가이드라인 (약비서 전용)
- **타겟 오디언스(4050):** 텍스트 크기는 너무 작지 않게 설정하고, 명도 대비를 확실하게 한다.
- **언어:** 모든 사용자에게 노출되는 UI 텍스트는 **한국어(Korean)**를 기본으로 한다. (개발용 로그 제외)
- **컬러 시스템:** - 긍정/안전: Green 계열 (`Colors.green`, `#2E7D32`)
  - 경고/중복: Amber/Orange 계열 (`Colors.orange`, `#FFF3E0`)
  - 텍스트 하드코딩 색상보다는 `Theme.of(context)` 활용을 지향한다.

---

## 15) AI 데이터 처리 (Gemini 연동 대비)
- **JSON 파싱 안전성:** AI가 생성한 JSON은 형식이 깨질 수 있음을 가정하고, 파싱 로직에는 반드시 `try-catch`와 `Default Value` 처리를 포함한다.
- **타입 변환:** 숫자(가격 등)는 `String`으로 올 수도 있고 `int`로 올 수도 있으므로, 파싱 시 안전하게 변환(`int.tryParse` 등)한다.

---

## 16) Git & 버전 관리 (Version Control)
- **커밋 단위:** "하나의 변경 사항 = 하나의 커밋" 원칙을 지킨다. (여러 기능을 한 번에 커밋 금지)
- **Pre-commit 체크:** 커밋/푸시 전에는 반드시 다음을 확인한다.
  - `flutter analyze` 실행 시 Error가 없는가?
  - `.env` 파일이나 API Key가 포함되지 않았는가? (필수)
  - 불필요한 주석이나 디버그용 `print()` 문이 제거되었는가?
- **커밋 메시지 컨벤션 (Conventional Commits):**
  - **형식:** `<type>: <subject>` (영문/한글 혼용 가능하나 일관성 유지)
  - **Types:**
    - `feat`: 새로운 기능 추가 (예: `feat: 검색 화면 UI 구현`)
    - `fix`: 버그 수정 (예: `fix: 결과 화면 가격 계산 로직 오류 수정`)
    - `refactor`: 기능 변경 없는 코드 구조 개선
    - `docs`: 문서 수정 (README, 주석 등)
    - `chore`: 빌드 설정, 패키지 매니저 설정 등
  - **Subject:** 50자 이내로 간결하게, 끝에 마침표(.) 찍지 않음.

---
 
## 17) 에이전트 작업 종료 시 (Hand-off)
개발 완료는 아래 조건을 모두 만족했을 때로 정의한다.

1) /review-cycle 실행
2) Blocker/Major 이슈가 0개
3) 테스트 실행/검증 완료(필요 시 추가 테스트 작성)
4) PR Description(What/Why/How + 테스트 방법) 작성 완료
5) Merge 전 체크리스트 완료

위 조건을 만족한 후에만 git에 merge(또는 PR merge)한다.

---